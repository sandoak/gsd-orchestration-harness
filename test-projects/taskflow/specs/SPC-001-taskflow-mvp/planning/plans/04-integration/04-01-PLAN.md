---
phase: 04-integration
plan: 01
type: execute
wave: 1
depends_on: ['03-03']
files_modified:
  - packages/web/e2e/tasks.spec.ts
  - packages/web/playwright.config.ts
autonomous: true
must_haves:
  truths:
    - 'E2E tests verify task creation flow'
    - 'E2E tests verify task completion toggle'
    - 'E2E tests verify task deletion'
  artifacts:
    - path: 'packages/web/playwright.config.ts'
      provides: 'Playwright configuration'
    - path: 'packages/web/e2e/tasks.spec.ts'
      provides: 'E2E test suite'
  key_links: []
must_pass:
  - id: ui-task-list-exists
    type: ui_element_exists
    selector: "[data-testid='task-list'], [data-testid='task-list-empty']"
    description: 'Task list or empty state renders'
  - id: ui-task-form-exists
    type: ui_element_exists
    selector: "[data-testid='task-form']"
    description: 'Task form renders'
ui_base_url: 'http://localhost:3000'
---

<objective>
Create Playwright end-to-end tests to verify the complete user flow works correctly.

Purpose: Validate the full integration of frontend and backend.
Output: Passing E2E test suite that can be run via Playwright.
</objective>

<execution_context>
@.harness/skills/workflows/execute-plan.md
@.harness/skills/templates/summary.md
</execution_context>

<context>
@specs/SPC-001-taskflow-mvp/SPEC.md
@specs/SPC-001-taskflow-mvp/execution/phases/03-frontend-ui/03-03-SUMMARY.md

**E2E Test scenarios:**

1. Page loads with form and list
2. Create a new task
3. Toggle task completion
4. Delete a task
5. Verify data persists

**Playwright verification types being tested:**

- ui_element_exists: Check elements render
- ui_form_submit: Test form submission
- ui_navigation: Test app navigation
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create Playwright configuration</name>
  <files>packages/web/playwright.config.ts</files>
  <action>
    Create packages/web/playwright.config.ts:

    ```typescript
    import { defineConfig, devices } from '@playwright/test';

    export default defineConfig({
      testDir: './e2e',
      fullyParallel: true,
      forbidOnly: !!process.env.CI,
      retries: process.env.CI ? 2 : 0,
      workers: process.env.CI ? 1 : undefined,
      reporter: 'html',
      use: {
        baseURL: 'http://localhost:3000',
        trace: 'on-first-retry',
      },
      projects: [
        {
          name: 'chromium',
          use: { ...devices['Desktop Chrome'] },
        },
      ],
      webServer: [
        {
          command: 'pnpm --filter @taskflow/api dev',
          url: 'http://localhost:3001/api/health',
          reuseExistingServer: !process.env.CI,
          cwd: '../..',
        },
        {
          command: 'pnpm --filter @taskflow/web dev',
          url: 'http://localhost:3000',
          reuseExistingServer: !process.env.CI,
          cwd: '../..',
        },
      ],
    });
    ```

  </action>
  <verify>
    - ls packages/web/playwright.config.ts
    - grep "webServer" packages/web/playwright.config.ts
  </verify>
  <done>
    - Playwright configured
    - Web servers auto-start for tests
  </done>
</task>

<task type="auto">
  <name>Task 2: Create E2E test suite</name>
  <files>packages/web/e2e/tasks.spec.ts</files>
  <action>
    Create packages/web/e2e/tasks.spec.ts:

    ```typescript
    import { test, expect } from '@playwright/test';

    test.describe('TaskFlow E2E Tests', () => {
      test.beforeEach(async ({ page }) => {
        await page.goto('/');
      });

      test.describe('Page Load', () => {
        test('should display the app header', async ({ page }) => {
          await expect(page.locator('h1')).toHaveText('TaskFlow');
        });

        test('should show the task form', async ({ page }) => {
          const form = page.locator('[data-testid="task-form"]');
          await expect(form).toBeVisible();
        });
      });

      test.describe('Task Creation', () => {
        test('should create a new task', async ({ page }) => {
          const taskTitle = `Test Task ${Date.now()}`;

          await page.fill('#task-title', taskTitle);
          await page.fill('#task-description', 'Test description');
          await page.click('button[type="submit"]');

          await expect(page.locator('.task-title', { hasText: taskTitle })).toBeVisible({ timeout: 5000 });
        });

        test('should clear form after submission', async ({ page }) => {
          const taskTitle = `Clear Test ${Date.now()}`;

          await page.fill('#task-title', taskTitle);
          await page.click('button[type="submit"]');

          await expect(page.locator('.task-title', { hasText: taskTitle })).toBeVisible();
          await expect(page.locator('#task-title')).toHaveValue('');
        });
      });

      test.describe('Task Management', () => {
        test('should toggle task completion', async ({ page }) => {
          const taskTitle = `Toggle Test ${Date.now()}`;

          await page.fill('#task-title', taskTitle);
          await page.click('button[type="submit"]');

          const taskItem = page.locator('[data-testid="task-item"]', { hasText: taskTitle });
          await expect(taskItem).toBeVisible();

          const checkbox = taskItem.locator('input[type="checkbox"]');
          await expect(checkbox).not.toBeChecked();

          await checkbox.click();
          await expect(checkbox).toBeChecked();
          await expect(taskItem).toHaveClass(/completed/);
        });

        test('should delete a task', async ({ page }) => {
          const taskTitle = `Delete Test ${Date.now()}`;

          await page.fill('#task-title', taskTitle);
          await page.click('button[type="submit"]');

          const taskItem = page.locator('[data-testid="task-item"]', { hasText: taskTitle });
          await expect(taskItem).toBeVisible();

          await taskItem.locator('.task-delete').click();
          await expect(taskItem).not.toBeVisible({ timeout: 5000 });
        });
      });
    });
    ```

  </action>
  <verify>
    - ls packages/web/e2e/tasks.spec.ts
    - grep "test.describe\|test\(" packages/web/e2e/tasks.spec.ts | wc -l
  </verify>
  <done>
    - Page load tests created
    - Task creation tests created
    - Task toggle and delete tests created
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] playwright.config.ts exists with webServer config
- [ ] e2e/tasks.spec.ts exists with test scenarios
- [ ] Tests can be run with: pnpm --filter @taskflow/web test:e2e
</verification>

<success_criteria>

- E2E tests cover full user flow
- Playwright configured with auto-starting servers
- Tests pass when both servers are running
  </success_criteria>

<output>
After completion, create `specs/SPC-001-taskflow-mvp/execution/phases/04-integration/04-01-SUMMARY.md`
</output>
