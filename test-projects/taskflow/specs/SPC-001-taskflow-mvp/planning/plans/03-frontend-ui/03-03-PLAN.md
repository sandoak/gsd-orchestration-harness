---
phase: 03-frontend-ui
plan: 03
type: execute
wave: 2
depends_on: ['03-01', '03-02', '02-02']
files_modified:
  - packages/web/src/api/tasks.ts
  - packages/web/src/api/index.ts
  - packages/web/src/hooks/useTasks.ts
  - packages/web/src/hooks/index.ts
  - packages/web/src/App.tsx
  - packages/web/src/App.css
autonomous: true
must_haves:
  truths:
    - 'API client fetches tasks from backend'
    - 'useTasks hook manages task state'
    - 'App integrates form and list components'
    - 'Full CRUD flow works'
  artifacts:
    - path: 'packages/web/src/api/tasks.ts'
      provides: 'Task API client'
      exports: ['tasksApi']
    - path: 'packages/web/src/hooks/useTasks.ts'
      provides: 'Task state management'
      exports: ['useTasks']
  key_links:
    - from: 'packages/web/src/hooks/useTasks.ts'
      to: 'packages/web/src/api/tasks.ts'
      via: 'import tasksApi'
    - from: 'packages/web/src/App.tsx'
      to: 'packages/web/src/hooks/useTasks.ts'
      via: 'const { tasks, ... } = useTasks()'
must_pass:
  - id: file-exists-api-client
    type: file_exists
    path: packages/web/src/api/tasks.ts
  - id: file-exists-hook
    type: file_exists
    path: packages/web/src/hooks/useTasks.ts
  - id: build-succeeds
    type: build_succeeds
    command: pnpm --filter @taskflow/web build
---

<objective>
Connect the React frontend to the Express backend API for full task management functionality.

Purpose: Complete the frontend with working API integration.
Output: Fully functional task management UI.
</objective>

<execution_context>
@.harness/skills/workflows/execute-plan.md
@.harness/skills/templates/summary.md
</execution_context>

<context>
@specs/SPC-001-taskflow-mvp/SPEC.md
@specs/SPC-001-taskflow-mvp/execution/phases/03-frontend-ui/03-01-SUMMARY.md
@specs/SPC-001-taskflow-mvp/execution/phases/03-frontend-ui/03-02-SUMMARY.md
@specs/SPC-001-taskflow-mvp/execution/phases/02-backend-api/02-02-SUMMARY.md
@packages/shared/src/types.ts

**Integration points:**

- API client: fetch wrapper for /api/tasks endpoints
- useTasks hook: state management with optimistic updates
- App.tsx: orchestrate components with hook
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create API client</name>
  <files>packages/web/src/api/tasks.ts, packages/web/src/api/index.ts</files>
  <action>
    1. Create packages/web/src/api/tasks.ts:
       ```typescript
       import type { Task, CreateTaskInput, UpdateTaskInput, ApiResponse } from '@taskflow/shared';

       const API_BASE = '/api';

       async function handleResponse<T>(response: Response): Promise<T> {
         if (!response.ok) {
           const error = await response.json().catch(() => ({ error: 'Request failed' }));
           throw new Error(error.error || `HTTP ${response.status}`);
         }
         return response.json();
       }

       export const tasksApi = {
         async getAll(): Promise<Task[]> {
           const response = await fetch(`${API_BASE}/tasks`);
           const data = await handleResponse<ApiResponse<Task[]>>(response);
           return data.data;
         },

         async create(input: CreateTaskInput): Promise<Task> {
           const response = await fetch(`${API_BASE}/tasks`, {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(input)
           });
           const data = await handleResponse<ApiResponse<Task>>(response);
           return data.data;
         },

         async update(id: string, input: UpdateTaskInput): Promise<Task> {
           const response = await fetch(`${API_BASE}/tasks/${id}`, {
             method: 'PATCH',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(input)
           });
           const data = await handleResponse<ApiResponse<Task>>(response);
           return data.data;
         },

         async delete(id: string): Promise<void> {
           const response = await fetch(`${API_BASE}/tasks/${id}`, { method: 'DELETE' });
           await handleResponse<ApiResponse<{ deleted: boolean }>>(response);
         }
       };
       ```

    2. Create packages/web/src/api/index.ts:
       ```typescript
       export { tasksApi } from './tasks';
       ```

  </action>
  <verify>
    - ls packages/web/src/api/tasks.ts packages/web/src/api/index.ts
  </verify>
  <done>
    - API client with all CRUD methods
    - Error handling with response parsing
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useTasks hook</name>
  <files>packages/web/src/hooks/useTasks.ts, packages/web/src/hooks/index.ts</files>
  <action>
    1. Create packages/web/src/hooks/useTasks.ts:
       ```typescript
       import { useState, useEffect, useCallback } from 'react';
       import type { Task, CreateTaskInput } from '@taskflow/shared';
       import { tasksApi } from '../api';

       interface UseTasksReturn {
         tasks: Task[];
         loading: boolean;
         error: string | null;
         creating: boolean;
         refresh: () => Promise<void>;
         createTask: (input: CreateTaskInput) => Promise<void>;
         toggleTask: (id: string, completed: boolean) => Promise<void>;
         deleteTask: (id: string) => Promise<void>;
       }

       export function useTasks(): UseTasksReturn {
         const [tasks, setTasks] = useState<Task[]>([]);
         const [loading, setLoading] = useState(true);
         const [creating, setCreating] = useState(false);
         const [error, setError] = useState<string | null>(null);

         const refresh = useCallback(async () => {
           try {
             setLoading(true);
             setError(null);
             const data = await tasksApi.getAll();
             setTasks(data);
           } catch (err) {
             setError(err instanceof Error ? err.message : 'Failed to load tasks');
           } finally {
             setLoading(false);
           }
         }, []);

         const createTask = useCallback(async (input: CreateTaskInput) => {
           try {
             setCreating(true);
             const newTask = await tasksApi.create(input);
             setTasks(prev => [newTask, ...prev]);
           } finally {
             setCreating(false);
           }
         }, []);

         const toggleTask = useCallback(async (id: string, completed: boolean) => {
           setTasks(prev => prev.map(t => t.id === id ? { ...t, completed } : t));
           try {
             await tasksApi.update(id, { completed });
           } catch {
             setTasks(prev => prev.map(t => t.id === id ? { ...t, completed: !completed } : t));
           }
         }, []);

         const deleteTask = useCallback(async (id: string) => {
           const taskToDelete = tasks.find(t => t.id === id);
           setTasks(prev => prev.filter(t => t.id !== id));
           try {
             await tasksApi.delete(id);
           } catch {
             if (taskToDelete) setTasks(prev => [...prev, taskToDelete]);
           }
         }, [tasks]);

         useEffect(() => { refresh(); }, [refresh]);

         return { tasks, loading, error, creating, refresh, createTask, toggleTask, deleteTask };
       }
       ```

    2. Create packages/web/src/hooks/index.ts:
       ```typescript
       export { useTasks } from './useTasks';
       ```

  </action>
  <verify>
    - ls packages/web/src/hooks/useTasks.ts packages/web/src/hooks/index.ts
  </verify>
  <done>
    - useTasks hook with state management
    - Optimistic updates for toggle and delete
    - Error recovery
  </done>
</task>

<task type="auto">
  <name>Task 3: Update App.tsx to integrate components</name>
  <files>packages/web/src/App.tsx, packages/web/src/App.css</files>
  <action>
    Update packages/web/src/App.tsx:

    ```typescript
    import { TaskList, TaskForm } from './components';
    import { useTasks } from './hooks';
    import './App.css';

    function App() {
      const { tasks, loading, error, creating, createTask, toggleTask, deleteTask } = useTasks();

      return (
        <div className="app">
          <header>
            <h1>TaskFlow</h1>
            <p>A minimal task management app</p>
          </header>
          <main>
            <section className="form-section">
              <TaskForm onSubmit={createTask} submitting={creating} />
            </section>
            <section className="list-section">
              <TaskList tasks={tasks} loading={loading} error={error} onToggle={toggleTask} onDelete={deleteTask} />
            </section>
          </main>
        </div>
      );
    }

    export default App;
    ```

    Update App.css with proper section styling.

  </action>
  <verify>
    - grep "useTasks\|TaskList\|TaskForm" packages/web/src/App.tsx
    - pnpm --filter @taskflow/web build
  </verify>
  <done>
    - App integrates all components
    - Full CRUD flow works
    - Build succeeds
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] API client exists with all methods
- [ ] useTasks hook manages state
- [ ] App.tsx integrates components
- [ ] pnpm --filter @taskflow/web build succeeds
</verification>

<success_criteria>

- Frontend builds successfully
- Full E2E flow works with backend
- Ready for Playwright tests
  </success_criteria>

<output>
After completion, create `specs/SPC-001-taskflow-mvp/execution/phases/03-frontend-ui/03-03-SUMMARY.md`
</output>
