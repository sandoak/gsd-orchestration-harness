---
phase: 03-mcp-server
plan: 01
type: execute
---

<objective>
Set up MCP server package with stdio transport for Claude Code integration.

Purpose: Establish the MCP server foundation that Claude Code can connect to for session orchestration.
Output: Working MCP server with stdio transport, ready for tool implementations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (Phase 2 provides session management):

@.planning/phases/02-session-management/02-03-SUMMARY.md

# Key files from Phase 2:

@packages/session-manager/src/index.ts
@packages/session-manager/src/persistent-session-manager.ts

**Tech stack available:** pnpm workspaces, TypeScript 5.x strict, NodeNext resolution, @gsd/\* path aliases, better-sqlite3, vitest
**Established patterns:** Union types over enums, EventEmitter for events, injectable dependencies for testability

**Constraining decisions:**

- [02-01]: Injectable executable option for testability
- [02-02]: better-sqlite3 for SQLite persistence
- [02-03]: PersistentSessionManager as primary API

**MCP SDK reference:**

- Package: @modelcontextprotocol/sdk
- Transport: StdioServerTransport for Claude Code integration
- Pattern: McpServer class with typed tool definitions
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create mcp-server package scaffold</name>
  <files>packages/mcp-server/package.json, packages/mcp-server/tsconfig.json, packages/mcp-server/src/index.ts</files>
  <action>
Create new package in packages/mcp-server with:
- package.json with name "@gsd/mcp-server", dependencies on @modelcontextprotocol/sdk (^1.0.0), @gsd/session-manager, @gsd/core
- tsconfig.json extending root config with NodeNext module resolution
- src/index.ts as entry point (empty for now, will be implemented in Task 2)
- Add "bin" entry in package.json pointing to dist/index.js for CLI execution
- Ensure package.json scripts include "build", "dev", "start" (tsx for dev, node for prod)

Do NOT add any tool implementations yet - just the package scaffold.
</action>
<verify>pnpm install succeeds, pnpm -F @gsd/mcp-server build compiles without errors</verify>
<done>Package scaffold exists, builds successfully, dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Implement MCP server with stdio transport</name>
  <files>packages/mcp-server/src/index.ts, packages/mcp-server/src/server.ts</files>
  <action>
Create the MCP server implementation:

1. src/server.ts - Main server class:
   - Import McpServer and StdioServerTransport from @modelcontextprotocol/sdk/server
   - Create GsdMcpServer class that:
     - Accepts PersistentSessionManager as constructor parameter
     - Creates McpServer instance with name "gsd-harness" and version from package.json
     - Exposes start() method that connects StdioServerTransport
     - Has placeholder for tool registration (tools added in 03-02, 03-03)

2. src/index.ts - CLI entry point:
   - Import PersistentSessionManager from @gsd/session-manager
   - Import GsdMcpServer from ./server.js
   - Create manager instance with default options
   - Create server instance, call start()
   - Handle SIGINT/SIGTERM for graceful shutdown (call manager.close())

Server must work with stdio transport (required for Claude Code integration).
Use ES module imports with .js extensions.

Do NOT implement any tools yet - that's 03-02 and 03-03.
</action>
<verify>pnpm -F @gsd/mcp-server build succeeds, pnpm -F @gsd/mcp-server start launches server (will exit immediately since no tools, but no errors)</verify>
<done>MCP server starts with stdio transport, graceful shutdown works, ready for tool registration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm -F @gsd/mcp-server build` succeeds without errors
- [ ] `pnpm -F @gsd/mcp-server start` launches server (will show MCP handshake waiting)
- [ ] No TypeScript errors in the package
- [ ] Package exports GsdMcpServer class for potential testing
</verification>

<success_criteria>

- MCP server package created with proper dependencies
- StdioServerTransport implemented for Claude Code integration
- Server starts and handles graceful shutdown
- Ready for tool implementations in subsequent plans
  </success_criteria>

<output>
After completion, create `.planning/phases/03-mcp-server/03-01-SUMMARY.md`
</output>
