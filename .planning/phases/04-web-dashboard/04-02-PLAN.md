---
phase: 04-web-dashboard
plan: 02
type: execute
---

<objective>
Create React + Vite dashboard with Zustand state management and WebSocket connection.

Purpose: Provide browser UI that displays session status and receives real-time updates.
Output: Working dashboard package with session state management and 3-slot panel layout.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context:

@.planning/phases/04-web-dashboard/04-01-SUMMARY.md

# Types for WebSocket messages:

@packages/web-server/src/types.ts
@packages/core/src/types/session.ts
@packages/core/src/types/events.ts

**Tech stack available:** pnpm workspaces, TypeScript strict, Fastify WebSocket at ws://localhost:3333/ws
**Established patterns:** @gsd/\* workspace imports, typed events
**Constraining decisions:**

- [04-01]: WebSocket messages are SessionEvent JSON with type discriminator
- [04-01]: GET /api/sessions returns session list
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard package with Vite + React + Tailwind</name>
  <files>packages/dashboard/package.json, packages/dashboard/tsconfig.json, packages/dashboard/vite.config.ts, packages/dashboard/index.html, packages/dashboard/src/main.tsx, packages/dashboard/src/App.tsx, packages/dashboard/tailwind.config.js, packages/dashboard/postcss.config.js, packages/dashboard/src/index.css</files>
  <action>
    Create @gsd/dashboard package:
    - package.json with:
      - react ^19.0.0, react-dom ^19.0.0
      - zustand ^5.0.0
      - tailwindcss ^3.4.0, postcss, autoprefixer (dev)
      - vite ^6.0.0, @vitejs/plugin-react ^4.0.0 (dev)
      - typescript, @types/react, @types/react-dom (dev)
    - tsconfig.json: target ESNext, module ESNext, jsx react-jsx, strict mode
    - vite.config.ts: React plugin, server port 5173, proxy /api and /ws to localhost:3333
    - index.html with root div, title "GSD Session Harness"
    - tailwind.config.js covering src/**/*.tsx
    - postcss.config.js with tailwindcss and autoprefixer
    - src/index.css with @tailwind base/components/utilities
    - src/main.tsx: React 19 createRoot render
    - src/App.tsx: Simple shell with "GSD Session Harness" header
    - Add "dev": "vite" and "build": "vite build" scripts
    - Do NOT add to root tsconfig.json references (Vite handles its own build)
  </action>
  <verify>cd packages/dashboard && pnpm install && pnpm dev starts without errors, visit localhost:5173</verify>
  <done>Dashboard shows header text, Tailwind styles work, Vite HMR functional</done>
</task>

<task type="auto">
  <name>Task 2: Add Zustand store with WebSocket connection</name>
  <files>packages/dashboard/src/store/session-store.ts, packages/dashboard/src/store/use-websocket.ts, packages/dashboard/src/types.ts</files>
  <action>
    Create session state management:
    - src/types.ts: Copy/align with web-server message types (Session, SessionStatus, SessionEvent discriminated union)
    - src/store/session-store.ts: Zustand store with:
      - sessions: Map&lt;string, Session&gt; (keyed by session ID)
      - output: Map&lt;string, string[]&gt; (session ID to output lines array)
      - connected: boolean (WebSocket status)
      - Actions: setSession, appendOutput, setConnected, handleEvent (processes SessionEvent)
      - handleEvent uses switch on event.type to route to appropriate action
    - src/store/use-websocket.ts: Custom hook that:
      - Connects to ws://localhost:3333/ws on mount (via Vite proxy)
      - Parses JSON messages and calls store.handleEvent()
      - Sets connected state
      - Reconnects on disconnect with exponential backoff (max 10s)
      - Fetches initial state from /api/sessions on connect
    - Export useSessionStore and useWebSocket from index files
  </action>
  <verify>pnpm -r build passes (dashboard excluded from tsc), npm run type-check in dashboard passes</verify>
  <done>Store handles all SessionEvent types, WebSocket hook manages connection lifecycle</done>
</task>

<task type="auto">
  <name>Task 3: Build session panel layout with 3-slot grid</name>
  <files>packages/dashboard/src/components/SessionPanel.tsx, packages/dashboard/src/components/SessionSlot.tsx, packages/dashboard/src/App.tsx</files>
  <action>
    Create session visualization components:
    - src/components/SessionSlot.tsx:
      - Props: slot (1|2|3), session (Session | undefined)
      - Display: slot number, session status badge (colored by status), working dir
      - Status colors: idle=gray, running=green, waiting_checkpoint=yellow, completed=blue, failed=red
      - If no session: show "Empty" with dashed border
      - Reserve space for terminal (added in 04-03)
    - src/components/SessionPanel.tsx:
      - Uses useSessionStore to get sessions
      - Renders 3 SessionSlot components in CSS grid (1x3 on desktop, 1x1 on mobile)
      - Groups sessions by slot number (sessions have slot: 1|2|3)
    - Update App.tsx:
      - Call useWebSocket() hook to establish connection
      - Show connection status indicator (green/red dot)
      - Render SessionPanel as main content
      - Use Tailwind: dark bg (slate-900), full viewport height
    - Tailwind styling: minimal, functional (this is a dev tool, not consumer product)
  </action>
  <verify>pnpm dev shows 3 session slots, status indicators reflect idle state</verify>
  <done>Dashboard displays 3 session slots, connection indicator works, status badges render</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm -r build` succeeds (dashboard uses Vite build)
- [ ] Dashboard dev server starts at localhost:5173
- [ ] WebSocket connects to backend (when 04-01 server running)
- [ ] Session slots render with status indicators
- [ ] Connection status indicator visible
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Dashboard functional without terminal (added next plan)
- Zustand store correctly processes all event types
  </success_criteria>

<output>
After completion, create `.planning/phases/04-web-dashboard/04-02-SUMMARY.md`
</output>
