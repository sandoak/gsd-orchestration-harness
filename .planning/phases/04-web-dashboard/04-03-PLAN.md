---
phase: 04-web-dashboard
plan: 03
type: execute
---

<objective>
Integrate xterm.js terminals with ANSI support for real-time session output display.

Purpose: Display live Claude CLI output in browser with full terminal emulation.
Output: Working terminal components that render session output with ANSI colors.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context:

@.planning/phases/04-web-dashboard/04-01-SUMMARY.md
@.planning/phases/04-web-dashboard/04-02-SUMMARY.md

# Dashboard components:

@packages/dashboard/src/store/session-store.ts
@packages/dashboard/src/components/SessionSlot.tsx

**Tech stack available:** React 19, Zustand, Tailwind, Vite, WebSocket connection
**Established patterns:** Zustand store with output Map, SessionSlot components per slot
**Constraining decisions:**

- [04-02]: Output stored as string[] in Zustand (output: Map<sessionId, string[]>)
- [04-02]: SessionSlot has reserved space for terminal
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add xterm.js terminal component with ANSI support</name>
  <files>packages/dashboard/src/components/Terminal.tsx, packages/dashboard/package.json</files>
  <action>
    Create Terminal component with xterm.js:
    - Add dependencies: @xterm/xterm ^5.0.0, @xterm/addon-fit ^0.10.0, @xterm/addon-web-links ^0.11.0
    - src/components/Terminal.tsx:
      - Props: sessionId (string), className (optional)
      - Use useRef for terminal container div
      - Initialize xterm.Terminal in useEffect with options:
        - theme: dark (background #1e293b to match slate-800)
        - fontSize: 13, fontFamily: 'Menlo, Monaco, monospace'
        - cursorBlink: false (read-only display)
        - disableStdin: true (view only, no input)
        - convertEol: true (handle line endings)
        - scrollback: 5000 lines
      - Load FitAddon and call fit() on mount and window resize
      - Load WebLinksAddon for clickable URLs
      - terminal.write() handles raw ANSI output (xterm parses automatically)
      - Export terminal instance via useImperativeHandle for parent control
      - Cleanup: dispose terminal on unmount
    - CSS: Import '@xterm/xterm/css/xterm.css' in component or main.tsx
  </action>
  <verify>Component compiles, can render empty terminal with dark theme</verify>
  <done>Terminal renders with dark theme, fit addon works, ANSI codes display correctly</done>
</task>

<task type="auto">
  <name>Task 2: Connect terminals to Zustand session output streams</name>
  <files>packages/dashboard/src/hooks/use-session-output.ts, packages/dashboard/src/components/Terminal.tsx, packages/dashboard/src/store/session-store.ts</files>
  <action>
    Wire output stream to terminal:
    - src/hooks/use-session-output.ts:
      - Custom hook: useSessionOutput(sessionId: string)
      - Subscribes to store.output.get(sessionId) changes
      - Returns { output: string[], lastIndex: number } for incremental writes
      - Tracks lastWrittenIndex to avoid re-writing same content
    - Update Terminal.tsx:
      - Accept sessionId prop
      - Use useSessionOutput hook
      - useEffect that writes new output lines when output array grows
      - Write each new line with terminal.writeln() for proper line handling
      - Handle output that arrives as chunks (single string with embedded \n)
    - Update session-store.ts if needed:
      - Ensure appendOutput handles both full lines and partial chunks
      - Output arrives as raw string from WebSocket, may contain multiple lines
      - Store as array of chunks (not split by newline - let terminal handle)
  </action>
  <verify>Build passes, terminal writes output when store.appendOutput called</verify>
  <done>New output chunks appear in terminal immediately, ANSI colors render correctly</done>
</task>

<task type="auto">
  <name>Task 3: Integrate terminals into session slots with status controls</name>
  <files>packages/dashboard/src/components/SessionSlot.tsx, packages/dashboard/src/components/SessionPanel.tsx, packages/dashboard/src/App.tsx</files>
  <action>
    Complete session slot integration:
    - Update SessionSlot.tsx:
      - Render Terminal component when session exists
      - Terminal takes remaining height below header (flex-1)
      - Show placeholder when slot is empty (no session)
      - Add visual checkpoint indicator if status is 'waiting_checkpoint'
      - Checkpoint indicator: yellow border/badge showing "Waiting for checkpoint"
    - Update SessionPanel.tsx:
      - Ensure grid layout gives equal space to each slot
      - Desktop: 3 columns, each slot ~1/3 width
      - Handle window resize gracefully (terminals re-fit)
    - Update App.tsx:
      - Add header showing "GSD Session Harness" with connection status
      - Full height layout: header (fixed) + SessionPanel (flex-1)
      - Dark theme consistent throughout (slate-900 bg)
  </action>
  <verify>pnpm dev shows 3 terminal slots, connection indicator, checkpoint badges</verify>
  <done>Terminals fill session slots, resize correctly, checkpoint status visible</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete web dashboard with real-time terminal output display</what-built>
  <how-to-verify>
    1. Terminal 1: cd packages/web-server && pnpm dev (or create test script)
    2. Terminal 2: cd packages/dashboard && pnpm dev
    3. Visit http://localhost:5173
    4. Verify:
       - 3 session slots displayed in grid
       - Connection indicator shows green (connected)
       - Slots show "Empty" or session status
       - Dark theme consistent throughout
    5. If web-server not ready: verify terminals render with placeholder content
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm -r build` succeeds
- [ ] Dashboard starts at localhost:5173
- [ ] xterm.js terminals render with dark theme
- [ ] ANSI colors display correctly (test with sample ANSI output)
- [ ] Terminals resize with window
- [ ] Human verification passed
</verification>

<success_criteria>

- All tasks completed including human verification
- All verification checks pass
- Terminals display real-time output when connected to running harness
- Phase 4 complete, ready for Phase 5 (GSD Integration)
  </success_criteria>

<output>
After completion, create `.planning/phases/04-web-dashboard/04-03-SUMMARY.md`
</output>
